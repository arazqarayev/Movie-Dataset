# üé¨ MOVIE DATA ANALYSIS
# Author: Araz Garayev
# Description: This script performs basic data cleaning, exploration, and correlation analysis
# on a movie dataset using Pandas, NumPy, Matplotlib, and Seaborn.

# -----------------------------
# 1Ô∏è‚É£ Importing necessary libraries
# -----------------------------
import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib
import matplotlib.pyplot as plt
plt.style.use('ggplot')
from matplotlib.pyplot import figure

# %matplotlib inline (only needed in Jupyter Notebook to display plots inline)
matplotlib.rcParams['figure.figsize'] = (12, 8)

# -----------------------------
# 2Ô∏è‚É£ Read dataset
# -----------------------------
df = pd.read_csv(r'C:\Users\User\OneDrive\Desktop\data\movies.csv')

# Display first few rows to confirm data loaded correctly
df.head()

# -----------------------------
# 3Ô∏è‚É£ Data cleaning - Check for missing values
# -----------------------------
print("üîç Missing Value Percentage by Column:")
for col in df.columns:
    pct_missing = np.mean(df[col].isnull())
    print(f"{col} - {pct_missing:.2%}")

# -----------------------------
# 4Ô∏è‚É£ Remove rows with missing values in key columns
# -----------------------------
# These are critical columns for analysis, so rows missing them are dropped
df = df.dropna(subset=['rating', 'gross', 'released', 'score', 
                       'votes', 'writer', 'star', 'company', 
                       'runtime', 'country'])

# -----------------------------
# 5Ô∏è‚É£ Check data types
# -----------------------------
# We check the data type of the 'budget' column to understand if it‚Äôs numeric or categorical
print(df['budget'].dtypes)

# -----------------------------
# 6Ô∏è‚É£ Handle missing values in budget column
# -----------------------------
# Budget had around 28% missing data. Median was chosen as the best replacement (robust to outliers).
df['budget'] = df['budget'].fillna(df['budget'].median())

# Verify type conversion
print("\nüìà After Type Conversion:")
print(df.dtypes[['budget', 'gross']])
print(df.head(3), "\n")

# -----------------------------
# 7Ô∏è‚É£ Create a 'year_correct' column
# -----------------------------
# Extract the year from the 'released' column (the first 4 digits represent the year)
df['year_correct'] = df['released'].astype(str).str.extract(r'(\d{4})')

# -----------------------------
# 8Ô∏è‚É£ Sort dataset by gross revenue (descending)
# -----------------------------
df_sorted = df.sort_values(by='gross', ascending=False)

# Optional: Display all rows (use carefully for large datasets)
pd.set_option('display.max_rows', None)

# -----------------------------
# 9Ô∏è‚É£ Unique production companies
# -----------------------------
unique_companies = df['company'].drop_duplicates().sort_values(ascending=False)
print("üè¢ Number of unique production companies:", len(unique_companies))

# -----------------------------
# üîü Top 10 production companies by film count
# -----------------------------
top_companies = df['company'].value_counts().head(10)

# Visualize as a horizontal bar chart
sns.barplot(x=top_companies.values, y=top_companies.index)
plt.title('Top 10 Production Companies by Film Count')
plt.xlabel('Number of Films')
plt.ylabel('Production Company')
plt.show()

# -----------------------------
# 11Ô∏è‚É£ Correlation analysis
# -----------------------------
# Calculate correlation matrix for numeric columns
corr_matrix = df.corr(method='pearson', numeric_only=True)

print("\nüìä Pearson Correlation Matrix (Numeric Columns):")
print(corr_matrix)

# -----------------------------
# 12Ô∏è‚É£ Visualize correlation matrix
# -----------------------------
sns.heatmap(corr_matrix, annot=True, cmap="coolwarm")
plt.title('Correlation Matrix for Numeric Features')
plt.xlabel('Movie Features')
plt.ylabel('Movie Features')
plt.tight_layout()
plt.show()
